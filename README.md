
# Домашняя работа по UE5

Выполнил студент БПИ219 Гладких Иван

## Генерация комнаты

Комната реализована в *BP_Room*, представляет из себя прямоугольное помещение.
На вход подаются переменные *Finish* типа *BOOLEAN*, указывающая, является ли комната финальной, и Difficulty типа Integer, обозначающая уровень сложности комнаты.

Генерация разбита на два основных этапа:
1. *Construction script - генерация каркаса*
	1. Из таблицы *DT_Room_Difficulties* импортируется основная информация о комнате (размер, количество акторов каждого типа, скорость ловушек) согласно уровню сложности генерируемой комнаты
	2. Вход в комнату всегда расположен на одной стороне (0 по оси y в относительных координатах), выходы - на противоположной, поэтому генерируется Tile X - номер плитки по оси X - для входа и двух выходов *(Entrance X, SameExit X, HarderExit X)*. Если комната финальная, то выходы не генерируются.
	3. Согласно размеру пол заполняется с помощью Instanced Meshes типа Floor 400x400. Если плитка является крайней и плитка не соответсвует входу или одному из двух выходов, то рядом с ней устанавливается(-ются) стена(-ы)
2. *Event Begin Play - наполнение*
	1. На плитке, соответствующей входу, устанавливается турникет, который удаляет предыдущую комнату и заменяет вход на стену, когда игрок его пересекает.
	2. Если комната не финальная, то создаются выходы *(BP_SameDoor и BP_HarderDoor)*. Выход, повышающий уровень сложности следующей комнаты, имеет другой материал (сталь) и отмечен капустой.
	3. Генерируется массив с типами плиток *E_TileTypes*: если уровень сложности текущей комнаты выше предыдущей, то добавляется бонус исцеления *(Heal)*; если комната финальная, то добавляется бонус окончания игры - капуста *(Cabbage)*; согласно уровню сложности комнаты добавляется определенное количество ловушек *(Trap)*, баффов *(Bonus)*, дебаффов *(Debuff)* и случайных эффектов *(Random)*. Затем массив дополняется пустыми плитками *(Plain)* до нужного размера и перемешивается.
	4. Согласно сгенерированному комната заполняется соответствующими акторами: каждый элемент массива соответствует одной плитке. Так как ловушки и баффы имеет представлены в нескольких видах, перед их размещением рандомно выбирается тип из соответствующего перечисления: *E_TrapTypes* или *E_BonusTypes*.

## Генерация уровня

1. Игра начинается в начальной комнате - *BP_Start*. Его встречает единственная дверь - *BP_HarderDoor*, при открытии которой (по нажатию на клавишу Е) будет сгенерирована первая комната.
2. Ссылка на стартовое лобби и первую комнату сохраняются в *BP_GameState* в полях *Start* и *CurrentRoom* соответственно. Также в *BP_GameState* рандомно задается параметр *MaxRooms* (в диапазоне от 6 до 10), обозначающий максимальное число комнат на уровне.
3. При пересечении первого турникета актор *BP_Start* удаляется и флажок *Started* в *BP_GameState* устанавливается на *true* (чтобы дальше работать только с комнатами). Затем вместо двери появляется стена.
4. Далее при открытии одной из двух дверей так же генерируется новая комната. Ссылка на текущую комнату записывается в *PreviousRoom*, а ссылка на новую в *CurrentRoom* (в *BP_GameState*). Это сделано, чтобы по ссылке можно было легко удалить предыдущую комнату и снизить тем самым нагрузку, что и происходит при пересечении турникета следующей комнаты.

> При генерации каждой новой комнаты значение (изначально 0) переменной *Rooms* в *BP_GameState* инкрементируется (префиксно), и, когда ++Rooms равняется MaxRooms, новая комната считается финальной.

## Регулировка сложности

Так как максимальное число комнат - 10, было принято решение задавать уровень сложности комнаты целым числом от 0 до 9 (включительно). Это число определяет следующие параметры: размер комнаты, число ловушек, баффов, дебаффов, рандомных эффектов, а также скорость ловушек. Они заданы в таблице *DT_Room_Difficulties*